
plugins {
	id "nu.studer.plugindev" version "1.0.4"
	id "com.gradle.plugin-publish" version "0.9.4"
	id "org.ysb33r.gradletest" version "0.5.4"
}

apply plugin: "nu.studer.plugindev"
apply plugin: "jacoco"

repositories {
	mavenCentral()
	mavenLocal()
}

sourceSets {
	integTest {
		compileClasspath += main.output + test.output
		runtimeClasspath += main.output + test.output
	}
}

configurations {
	integTestCompile.extendsFrom testCompile
	integTestRuntime.extendsFrom testRuntime
}

dependencies {
	compile 'org.apache.maven:maven-core:3.3.9'
	testCompile	'junit:junit:4.12',
				'org.hamcrest:hamcrest-all:1.3'
	gradleTest 'com.android.tools.build:gradle:2.1.2'
}

sourceCompatibility = 1.6
targetCompatibility = 1.6

plugindev {
	pluginId = 'com.github.dcendents.android-maven'
	pluginImplementationClass 'org.gradle.api.plugins.AndroidMavenPlugin'
	pluginName 'Gradle Android Maven Plugin'
	pluginDescription 'Modification to the standard Maven plugin to be compatible with android-library projects (aar).'
	pluginLicenses 'Apache-2.0'
	pluginTags 'gradle', 'plugin', 'android', 'maven'
	authorId 'dcendents'
	authorName 'Daniel Beland'
	authorEmail 'dcendents@gmail.com'
	projectUrl 'https://github.com/dcendents/android-maven-gradle-plugin'
	projectInceptionYear '2013'
	done() // do not omit this
}

ext {
	// Set values in ~/.gradle/gradle.properties, set default values otherwise for build to work
	bintrayUsername = project.properties['bintrayUsername'] != null ? project.properties['bintrayUsername'] : ""
	bintrayApiKey = project.properties['bintrayApiKey'] != null ? project.properties['bintrayApiKey'] : ""
	bintrayPassphrase = project.properties['bintrayPassphrase'] != null ? project.properties['bintrayPassphrase'] : ""
}

bintray {
	user = "${bintrayUsername}"
	key = "${bintrayApiKey}"

	dryRun = false
	publish = true
	pkg {
		repo = 'gradle-plugins'
		name = 'com.github.dcendents:android-maven-plugin'
		version {
			gpg {
				sign = true
				passphrase = "${bintrayPassphrase}"
			}
		}
	}
}

pluginBundle {
	website = 'https://github.com/dcendents/android-maven-gradle-plugin'
	vcsUrl = 'https://github.com/dcendents/android-maven-gradle-plugin'

	description = 'Modification to the standard Maven plugin to be compatible with android-library projects (aar).'

	plugins {
		androidMavenPlugin {
			id = 'com.github.dcendents.android-maven'
			displayName = 'Gradle Android Maven plugin'
			tags = ['maven', 'android']
			version = version
		}
	}

	mavenCoordinates {
		groupId = group
		artifactId = theName
		version = version
	}
}

ext {
	gradleVersions = '2.14'
}

task integTest(type: Test) {
	systemProperty 'gradle.versions', gradleVersions
	testClassesDir = sourceSets.integTest.output.classesDir
	classpath = sourceSets.integTest.runtimeClasspath
	reports {
		junitXml.destination = "$buildDir/integration-test-results"
		reports.html.destination = "$buildDir/reports/integrationTests"
	}
}

gradleTest {
	versions gradleVersions.split(',')
}

gradleLocations {
	searchGradleUserHome = true
	includeGradleHome = false
	searchGvm = false
	download = true
	downloadToGradleUserHome = true
	useGradleSite = true
}

gradleTest.dependsOn jar
integTest.dependsOn gradleTest
check.dependsOn integTest

jacoco {
	toolVersion = "0.7.5.201505241946"
}

jacocoTestReport {
	reports {
		xml.enabled true
		html.enabled true
		html.destination "${buildDir}/jacocoHtml"
	}
}

jar.dependsOn test
jacocoTestReport.dependsOn test
check.dependsOn jacocoTestReport

task wrapper(type: Wrapper) {
    gradleVersion = '2.14'
    distributionUrl = "https://services.gradle.org/distributions/gradle-${gradleVersion}-all.zip"
}
